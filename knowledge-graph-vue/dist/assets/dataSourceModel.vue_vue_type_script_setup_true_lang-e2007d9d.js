var b=(y,w,_)=>new Promise((h,v)=>{var c=e=>{try{i(_.next(e))}catch(f){v(f)}},p=e=>{try{i(_.throw(e))}catch(f){v(f)}},i=e=>e.done?h(e.value):Promise.resolve(e.value).then(c,p);i((_=_.apply(y,w)).next())});import{_ as T}from"./index.vue_vue_type_script_setup_true_lang-24ddc9a9.js";import{d as V,m as C,ap as j,aq as I,H as M,Z as r,O as W,P as $,Q as l,R as a,S as o,U as A,W as g,ai as S,as as x,aj as F,ar as H}from"./index-4af02034.js";const Q={style:{"text-align":"right"}},G=V({__name:"dataSourceModel",props:{record:{},open:{type:Boolean}},emits:["OK","CANCEL"],setup(y,{emit:w}){const _=y,h=C([{label:"结构化数据",value:"结构化数据"},{label:"半结构数据",value:"半结构数据"},{label:"非结构化数据",value:"非结构化数据"}]),v=C([{label:"Elasticsearch",value:"Elasticsearch"},{label:"Kafka",value:"Kafka"}]),c=w,p=j(!1),i=C(),e=I({isOpenShot:!1});M(()=>{Object.assign(e,_.record)});function f(){return b(this,null,function*(){const s={};s.db_type=e.db_type,s.ip_address=e.ip_address,s.port=e.port,s.username=e.username,s.password=e.password,s.schema_table=e.schema_table,s.table_name=e.table_name,p.value=!0,S("/datasource/connection",s).then(t=>{t.status=="success"?(x("连接成功"),p.value=!1):(p.value=!0,F(t.msg))})})}function O(){return b(this,null,function*(){var t;const s=yield(t=i.value)==null?void 0:t.validateFields();_.record.id?(s.id=_.record.id,p.value=!0,H("/datasource/id/"+s.id,s).then(k=>{p.value=!1,x("保存成功"),c("ok")})):(p.value=!0,S("/datasource/",s).then(k=>{p.value=!1,x("保存成功"),c("ok")}))})}function q(){return b(this,null,function*(){e.value=null,c("cancel")})}return(s,t)=>{const k=T,m=r("a-input"),u=r("a-form-item"),d=r("a-col"),P=r("a-select"),B=r("a-switch"),E=r("a-textarea"),N=r("a-row"),R=r("a-form"),U=r("a-button"),K=r("a-space"),L=r("a-modal");return W(),$(L,{closable:!1,"destroy-on-close":!0,open:s.open,width:"900px",onOk:O},{title:l(()=>{var n;return[a(k,{title:(n=o(e))!=null&&n.id?"编辑":"新增","sub-title":""},null,8,["title"])]}),footer:l(()=>[A("div",Q,[a(K,null,{default:l(()=>[a(U,{onClick:f,type:"dashed"},{default:l(()=>[g(" 测试连接性 ")]),_:1}),a(U,{onClick:q},{default:l(()=>[g(" 取消 ")]),_:1}),a(U,{type:"primary",onClick:O},{default:l(()=>[g(" 保存 ")]),_:1})]),_:1})])]),default:l(()=>[a(R,{ref_key:"formRef",ref:i,model:o(e),name:"basic","label-col":{span:6},"wrapper-col":{span:30},autocomplete:"off"},{default:l(()=>[a(N,null,{default:l(()=>[a(d,{span:12},{default:l(()=>[a(u,{label:"名字",name:"name",rules:[{required:!0,message:"请输入名字"}]},{default:l(()=>[a(m,{value:o(e).name,"onUpdate:value":t[0]||(t[0]=n=>o(e).name=n),placeholder:"请输入名字"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"数据分类",name:"data_type",rules:[{required:!0,message:"请选择数据分类"}]},{default:l(()=>[a(P,{placeholder:"请选择数据分类",value:o(e).data_type,"onUpdate:value":t[1]||(t[1]=n=>o(e).data_type=n),options:h.value},null,8,["value","options"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"数据库类型",name:"db_type",rules:[{required:!0,message:"请选择数据库类型"}]},{default:l(()=>[a(P,{placeholder:"请选择数据库类型",value:o(e).db_type,"onUpdate:value":t[2]||(t[2]=n=>o(e).db_type=n),options:v.value},null,8,["value","options"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"IP地址",name:"ip_address"},{default:l(()=>[a(m,{value:o(e).ip_address,"onUpdate:value":t[3]||(t[3]=n=>o(e).ip_address=n),placeholder:"请输入IP地址"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"端口",name:"port"},{default:l(()=>[a(m,{value:o(e).port,"onUpdate:value":t[4]||(t[4]=n=>o(e).port=n),placeholder:"请输入端口"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"用户名",name:"username"},{default:l(()=>[a(m,{value:o(e).username,"onUpdate:value":t[5]||(t[5]=n=>o(e).username=n),placeholder:"请输入用户名"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"密码",name:"password"},{default:l(()=>[a(m,{value:o(e).password,"onUpdate:value":t[6]||(t[6]=n=>o(e).password=n),placeholder:"请输入密码"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"库",name:"schema_table"},{default:l(()=>[a(m,{value:o(e).schema_table,"onUpdate:value":t[7]||(t[7]=n=>o(e).schema_table=n),placeholder:"请输入库"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"表",name:"table_name"},{default:l(()=>[a(m,{value:o(e).table_name,"onUpdate:value":t[8]||(t[8]=n=>o(e).table_name=n),placeholder:"请输入表"},null,8,["value"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"状态",name:"enabled"},{default:l(()=>[a(B,{checked:o(e).enabled,"onUpdate:checked":t[9]||(t[9]=n=>o(e).enabled=n)},null,8,["checked"])]),_:1})]),_:1}),a(d,{span:12},{default:l(()=>[a(u,{label:"描述",name:"description"},{default:l(()=>[a(E,{value:o(e).description,"onUpdate:value":t[10]||(t[10]=n=>o(e).description=n),placeholder:"请输入描述"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}});export{G as _};

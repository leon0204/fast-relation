var I=(O,b,r)=>new Promise((x,v)=>{var w=n=>{try{c(r.next(n))}catch(l){v(l)}},p=n=>{try{c(r.throw(n))}catch(l){v(l)}},c=n=>n.done?x(n.value):Promise.resolve(n.value).then(w,p);c((r=r.apply(O,b)).next())});import{_ as A}from"./index.vue_vue_type_script_setup_true_lang-24ddc9a9.js";import{_ as L}from"./index.vue_vue_type_script_setup_true_lang-c8f76168.js";import{_ as Y}from"./dataSourceModel.vue_vue_type_script_setup_true_lang-e2007d9d.js";import{_ as ee}from"./CommonPage-69c64d74.js";import{d as ae,m as o,aq as T,ak as q,H as te,aa as oe,Z as _,O as k,P as h,Q as s,R as i,S as ne,at as le,W as C,U as B,X as se,$ as S,aj as z,ai as P,as as E,_ as ie}from"./index-4af02034.js";import"./ArrowUpOutlined-15a0d937.js";import"./UnorderedListOutlined-1cb56e24.js";import"./ChromeFilled-5bd66bf5.js";import"./EditFilled-d0e6b41f.js";import"./QuestionOutlined-b1288c8f.js";import"./AppPage-24725091.js";const ue={class:"content-table"},re={class:"dialog-footer"},ce=ae({__name:"index",setup(O){o();const b=T({}),r=o(!1);o([]);const x=o({}),v=o([]),w=o(0),p=o(!1),c=o(!1),n=o([]),l=o([]),$=o(null),V=o(""),f=T({page_size:10,pageSizeOptions:["10","20","30","40"],page:1,total:0,showSizeChanger:!0,showQuickJumper:!1,showTotal:a=>`总记录 ${a} `,onChange(a,e){f.page_size=e,f.page=a,g()}}),K=o([{title:"源实体",dataIndex:"head",key:"head"},{title:"关系",dataIndex:"relation",key:"relation"},{title:"目标实体",dataIndex:"tail",key:"tail"},{title:"来源",dataIndex:"source",key:"source"}]);function g(){if(r.value)return;r.value=!0;const a={};a.name=x.value.name,a.page=f.page,a.pagesize=f.page_size,a.index="entity_relations",q("/kg/entity/list",a).then(e=>{var t,d,m,y;v.value=e.data.data,f.total=((d=(t=e==null?void 0:e.data)==null?void 0:t.pagination)==null?void 0:d.total)||0,w.value=((y=(m=e==null?void 0:e.data)==null?void 0:m.pagination)==null?void 0:y.total)||0,r.value=!1})}function Q(){p.value=!1,g()}te(()=>{const e=oe().query.id;V.value=e,g()});const R=a=>I(this,null,function*(){const e=[];if(console.log(l.value),l.value&&l.value.length==0)return z("请选择实体"),!1;n.value.map(d=>{l.value.map(m=>{d._id==m&&e.push(d._id)})}),e.push($.value._id);const t={};t.entity_id=$.value._id,t.entity_list=e,P("/knowledge_merge/disambiguation",t).then(d=>{d.code==200?(E("实体消歧成功"),F(),c.value=!1):z("实体消歧失败")})}),D=()=>I(this,null,function*(){const a={};a.model_id=V.value,a.page=1,a.page_size=1e3,q("/kg/entity/list",a).then(e=>{n.value=e.data.data,n.value.map(t=>{t.label=t.name,t.key=t._id})})}),U=()=>{P("/kg/fusion/relations",{}).then(a=>{a.code==200?(E("关系融合成功"),F()):z("关系融合失败")})},W=a=>{},j=a=>{l.value=[],c.value=!0,$.value=a,console.log("item---------------------------"),console.log(a),D()},F=()=>{D(),g()};return(a,e)=>{const t=_("a-button"),d=_("a-space"),m=_("a-col"),y=_("a-row"),G=_("a-tag"),H=L,J=_("a-table"),M=A,X=_("a-transfer"),Z=_("a-modal");return k(),h(ee,{"show-footer":"",title:"数据源管理"},{default:s(()=>[i(y,null,{default:s(()=>[i(m,{span:24,style:{"text-align":"right"}},{default:s(()=>[i(d,null,{default:s(()=>[i(t,{type:"primary",style:{"background-color":"#F56C6C"},onClick:U},{default:s(()=>[i(ne(le)),C(" 关系融合 ")]),_:1})]),_:1})]),_:1})]),_:1}),B("div",ue,[i(J,{size:"middle",dataSource:v.value,columns:K.value,rowKey:"id",pagination:f,loading:r.value},{bodyCell:s(({column:u,record:N})=>[u.dataIndex==="source"?(k(),h(G,{key:0,color:"geekblue",bordered:!1},{default:s(()=>[C(se(N.source),1)]),_:2},1024)):S("",!0),u.dataIndex==="action"?(k(),h(H,{key:1,icon:"DeleteOutlined",label:"消歧",onClick:de=>j(N)},null,8,["onClick"])):S("",!0)]),_:1},8,["dataSource","columns","pagination","loading"])]),p.value?(k(),h(Y,{key:0,record:b,open:p.value,onOk:Q,onCancel:e[0]||(e[0]=u=>p.value=!1)},null,8,["record","open"])):S("",!0),i(Z,{open:c.value,"close-on-click-modal":!1,width:"500px",onCancel:e[4]||(e[4]=u=>c.value=!1)},{title:s(()=>[i(M,{title:"实体消歧"})]),footer:s(()=>[B("div",re,[i(t,{onClick:e[2]||(e[2]=u=>c.value=!1)},{default:s(()=>[C("取消")]),_:1}),i(t,{type:"primary",onClick:e[3]||(e[3]=u=>R(l.value))},{default:s(()=>[C("保存")]),_:1})])]),default:s(()=>[i(X,{style:{width:"100%"},"target-keys":l.value,"onUpdate:targetKeys":e[1]||(e[1]=u=>l.value=u),filterable:"","data-source":n.value,onChange:W,render:u=>u.name},null,8,["target-keys","data-source","render"])]),_:1},8,["open"])]),_:1})}}});const we=ie(ce,[["__scopeId","data-v-5c13795e"]]);export{we as default};

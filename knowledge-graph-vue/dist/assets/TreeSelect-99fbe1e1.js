import{a as je,b as De,d7 as ze,d8 as $e,d9 as We,e as He,f as U,a3 as ne,j as qe,d as Je,m,s as Ge,c7 as Qe,l as L,ca as V,q as c,da as Xe,J as Ye,u as oe,v as Ze,cb as j,x as et,h as u,cc as tt,cd as nt,ce as at,T as lt,y as ot,cf as rt,cl as it,cv as dt,cg as b,cj as st,ch as ct,ci as ut}from"./index-4af02034.js";import{c as ht,t as ft,u as gt,_ as vt,a as mt}from"./Tree-73292cf6.js";import{u as yt}from"./Input-a430a206.js";import{u as pt,j as bt,k as St,F as wt}from"./CrudTable-77c6359e.js";function kt(t){const{popoverColor:h,boxShadow2:r,borderRadius:s,heightMedium:d,dividerColor:y,textColor2:K}=t;return{menuPadding:"4px",menuColor:h,menuBoxShadow:r,menuBorderRadius:s,menuHeight:`calc(${d} * 7.6)`,actionDividerColor:y,actionTextColor:K,actionPadding:"8px 12px"}}const xt=je({name:"TreeSelect",common:De,peers:{Tree:ze,Empty:$e,InternalSelection:We},self:kt}),Tt=xt;function ae(t,h){const{rawNode:r}=t;return Object.assign(Object.assign({},r),{label:r[h],value:t.key})}function le(t,h,r,s){const{rawNode:d}=t;return Object.assign(Object.assign({},d),{value:t.key,label:h.map(y=>y.rawNode[s]).join(r)})}const Ct=He([U("tree-select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 `),U("tree-select-menu",`
 position: relative;
 overflow: hidden;
 margin: 4px 0;
 transition: box-shadow .3s var(--n-bezier), background-color .3s var(--n-bezier);
 border-radius: var(--n-menu-border-radius);
 box-shadow: var(--n-menu-box-shadow);
 background-color: var(--n-menu-color);
 outline: none;
 `,[U("tree","max-height: var(--n-menu-height);"),ne("empty",`
 display: flex;
 padding: 12px 32px;
 flex: 1;
 justify-content: center;
 `),ne("action",`
 padding: var(--n-action-padding);
 transition: 
 color .3s var(--n-bezier);
 border-color .3s var(--n-bezier);
 border-top: 1px solid var(--n-action-divider-color);
 color: var(--n-action-text-color);
 `),qe()])]),Kt=Object.assign(Object.assign(Object.assign(Object.assign({},oe.props),{bordered:{type:Boolean,default:!0},cascade:Boolean,checkable:Boolean,clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},consistentMenuWidth:{type:Boolean,default:!0},defaultShow:Boolean,defaultValue:{type:[String,Number,Array],default:null},disabled:{type:Boolean,default:void 0},filterable:Boolean,checkStrategy:{type:String,default:"all"},loading:Boolean,maxTagCount:[String,Number],multiple:Boolean,showPath:Boolean,separator:{type:String,default:" / "},options:{type:Array,default:()=>[]},placeholder:String,placement:{type:String,default:"bottom-start"},show:{type:Boolean,default:void 0},size:String,value:[String,Number,Array],to:j.propTo,menuProps:Object,virtualScroll:{type:Boolean,default:!0},status:String,renderTag:Function,ellipsisTagPopoverProps:Object}),mt),{renderLabel:Function,renderPrefix:Function,renderSuffix:Function,nodeProps:Function,watchProps:Array,getChildren:Function,onBlur:Function,onFocus:Function,onLoad:Function,onUpdateShow:[Function,Array],onUpdateValue:[Function,Array],"onUpdate:value":[Function,Array],"onUpdate:show":[Function,Array],leafOnly:Boolean}),It=Je({name:"TreeSelect",props:Kt,setup(t){const h=m(null),r=m(null),s=m(null),d=m(null),{mergedClsPrefixRef:y,namespaceRef:K,inlineThemeDisabled:g}=Ge(t),{localeRef:M}=yt("Select"),{mergedSizeRef:P,mergedDisabledRef:_,mergedStatusRef:re,nTriggerFormBlur:ie,nTriggerFormChange:de,nTriggerFormFocus:se,nTriggerFormInput:ce}=Qe(t),D=m(t.defaultValue),ue=L(t,"value"),S=V(ue,D),z=m(t.defaultShow),he=L(t,"show"),w=V(he,z),R=m(""),fe=c(()=>{const{filter:e}=t;if(e)return e;const{labelField:n}=t;return(l,a)=>l.length?a[n].toLowerCase().includes(l.toLowerCase()):!0}),k=c(()=>Xe(t.options,ht(t.keyField,t.childrenField,t.disabledField,void 0))),{value:O}=S,$=m(t.checkable?null:Array.isArray(O)&&O.length?O[O.length-1]:null),I=c(()=>t.multiple&&t.cascade&&t.checkable),W=m(t.defaultExpandAll?void 0:t.defaultExpandedKeys||t.expandedKeys),ge=L(t,"expandedKeys"),ve=V(ge,W),F=m(!1),me=c(()=>{const{placeholder:e}=t;return e!==void 0?e:M.value.placeholder}),H=c(()=>{const{value:e}=S;return t.multiple?Array.isArray(e)?e:[]:e===null||Array.isArray(e)?[]:[e]}),ye=c(()=>t.checkable?[]:H.value),pe=c(()=>{const{multiple:e,showPath:n,separator:l,labelField:a}=t;if(e)return null;const{value:o}=S;if(!Array.isArray(o)&&o!==null){const{value:i}=k,v=i.getNode(o);if(v!==null)return n?le(v,i.getPath(o).treeNodePath,l,a):ae(v,a)}return null}),be=c(()=>{const{multiple:e,showPath:n,separator:l}=t;if(!e)return null;const{value:a}=S;if(Array.isArray(a)){const o=[],{value:i}=k,{checkedKeys:v}=i.getCheckedKeys(a,{checkStrategy:t.checkStrategy,cascade:I.value,allowNotLoaded:t.allowCheckingNotLoaded}),{labelField:f}=t;return v.forEach(te=>{const E=i.getNode(te);E!==null&&o.push(n?le(E,i.getPath(te).treeNodePath,l,f):ae(E,f))}),o}return[]});function B(){var e;(e=r.value)===null||e===void 0||e.focus()}function q(){var e;(e=r.value)===null||e===void 0||e.focusInput()}function J(e){const{onUpdateShow:n,"onUpdate:show":l}=t;n&&b(n,e),l&&b(l,e),z.value=e}function x(e,n,l){const{onUpdateValue:a,"onUpdate:value":o}=t;a&&b(a,e,n,l),o&&b(o,e,n,l),D.value=e,ce(),de()}function Se(e,n){const{onUpdateIndeterminateKeys:l,"onUpdate:indeterminateKeys":a}=t;l&&b(l,e,n),a&&b(a,e,n)}function we(e,n,l){const{onUpdateExpandedKeys:a,"onUpdate:expandedKeys":o}=t;a&&b(a,e,n,l),o&&b(o,e,n,l),W.value=e}function G(e){const{onFocus:n}=t;n&&n(e),se()}function Q(e){p();const{onBlur:n}=t;n&&n(e),ie()}function p(){J(!1)}function A(){_.value||(R.value="",J(!0),t.filterable&&q())}function ke(){R.value=""}function xe(e){var n;w.value&&(!((n=r.value)===null||n===void 0)&&n.$el.contains(st(e))||p())}function Te(){_.value||(w.value?t.filterable||p():A())}function T(e){const{value:{getNode:n}}=k;return e.map(l=>{var a;return((a=n(l))===null||a===void 0?void 0:a.rawNode)||null})}function Ce(e,n,l){const a=T(e),o=l.action==="check"?"select":"unselect",i=l.node;t.multiple?(x(e,a,{node:i,action:o}),t.filterable&&(q(),t.clearFilterAfterSelect&&(R.value=""))):(e.length?x(e[0],a[0]||null,{node:i,action:o}):x(null,null,{node:i,action:o}),p(),B())}function Ke(e){t.checkable&&Se(e,T(e))}function Re(e){var n;!((n=d.value)===null||n===void 0)&&n.contains(e.relatedTarget)||(F.value=!0,G(e))}function Fe(e){var n;!((n=d.value)===null||n===void 0)&&n.contains(e.relatedTarget)||(F.value=!1,Q(e))}function Pe(e){var n,l,a;!((n=d.value)===null||n===void 0)&&n.contains(e.relatedTarget)||!((a=(l=r.value)===null||l===void 0?void 0:l.$el)===null||a===void 0)&&a.contains(e.relatedTarget)||(F.value=!0,G(e))}function Oe(e){var n,l,a;!((n=d.value)===null||n===void 0)&&n.contains(e.relatedTarget)||!((a=(l=r.value)===null||l===void 0?void 0:l.$el)===null||a===void 0)&&a.contains(e.relatedTarget)||(F.value=!1,Q(e))}function Ie(e){e.stopPropagation();const{multiple:n}=t;!n&&t.filterable&&p(),n?x([],[],{node:null,action:"clear"}):x(null,null,{node:null,action:"clear"})}function Be(e){const{value:n}=S;if(Array.isArray(n)){const{value:l}=k,{checkedKeys:a}=l.getCheckedKeys(n,{cascade:I.value,allowNotLoaded:t.allowCheckingNotLoaded}),o=a.findIndex(i=>i===e.value);if(~o){const i=a[o],v=T([i])[0];if(t.checkable){const{checkedKeys:f}=l.uncheck(e.value,a,{checkStrategy:t.checkStrategy,cascade:I.value,allowNotLoaded:t.allowCheckingNotLoaded});x(f,T(f),{node:v,action:"delete"})}else{const f=Array.from(a);f.splice(o,1),x(f,T(f),{node:v,action:"delete"})}}}}function Me(e){const{value:n}=e.target;R.value=n}function X(e){const{value:n}=s;return n?n.handleKeydown(e):{enterBehavior:null}}function _e(e){if(e.key==="Enter"){if(w.value){const{enterBehavior:n}=X(e);if(!t.multiple)switch(n){case"default":case"toggleSelect":p(),B();break}}else A();e.preventDefault()}else e.key==="Escape"?w.value&&(ct(e),p(),B()):w.value?X(e):e.key==="ArrowDown"&&A()}function Ae(){p(),B()}function Ne(e){ut(e,"action")||e.preventDefault()}const Ee=c(()=>{const{renderTag:e}=t;if(e)return function({option:l,handleClose:a}){const{value:o}=l;if(o!==void 0){const i=k.value.getNode(o);if(i)return e({option:i.rawNode,handleClose:a})}return o}});Ye(ft,{pendingNodeKeyRef:$,dataTreeMate:k});function Y(){var e;w.value&&((e=h.value)===null||e===void 0||e.syncPosition())}pt(d,Y);const Ue=gt(t),Z=c(()=>{if(t.checkable){const e=S.value;return t.multiple&&Array.isArray(e)?k.value.getCheckedKeys(e,{cascade:t.cascade,checkStrategy:Ue.value,allowNotLoaded:t.allowCheckingNotLoaded}):{checkedKeys:Array.isArray(e)||e===null?[]:[e],indeterminateKeys:[]}}return{checkedKeys:[],indeterminateKeys:[]}}),Le={getCheckedData:()=>{const{checkedKeys:e}=Z.value;return{keys:e,options:T(e)}},getIndeterminateData:()=>{const{indeterminateKeys:e}=Z.value;return{keys:e,options:T(e)}},focus:()=>{var e;return(e=r.value)===null||e===void 0?void 0:e.focus()},focusInput:()=>{var e;return(e=r.value)===null||e===void 0?void 0:e.focusInput()},blur:()=>{var e;return(e=r.value)===null||e===void 0?void 0:e.blur()},blurInput:()=>{var e;return(e=r.value)===null||e===void 0?void 0:e.blurInput()}},N=oe("TreeSelect","-tree-select",Ct,Tt,t,y),ee=c(()=>{const{common:{cubicBezierEaseInOut:e},self:{menuBoxShadow:n,menuBorderRadius:l,menuColor:a,menuHeight:o,actionPadding:i,actionDividerColor:v,actionTextColor:f}}=N.value;return{"--n-menu-box-shadow":n,"--n-menu-border-radius":l,"--n-menu-color":a,"--n-menu-height":o,"--n-bezier":e,"--n-action-padding":i,"--n-action-text-color":f,"--n-action-divider-color":v}}),C=g?Ze("tree-select",void 0,ee,t):void 0,Ve=c(()=>{const{self:{menuPadding:e}}=N.value;return e});return Object.assign(Object.assign({},Le),{menuElRef:d,mergedStatus:re,triggerInstRef:r,followerInstRef:h,treeInstRef:s,mergedClsPrefix:y,mergedValue:S,mergedShow:w,namespace:K,adjustedTo:j(t),isMounted:et(),focused:F,menuPadding:Ve,mergedPlaceholder:me,mergedExpandedKeys:ve,treeSelectedKeys:ye,treeCheckedKeys:H,mergedSize:P,mergedDisabled:_,selectedOption:pe,selectedOptions:be,pattern:R,pendingNodeKey:$,mergedCascade:I,mergedFilter:fe,selectionRenderTag:Ee,handleTriggerOrMenuResize:Y,doUpdateExpandedKeys:we,handleMenuLeave:ke,handleTriggerClick:Te,handleMenuClickoutside:xe,handleUpdateCheckedKeys:Ce,handleUpdateIndeterminateKeys:Ke,handleTriggerFocus:Re,handleTriggerBlur:Fe,handleMenuFocusin:Pe,handleMenuFocusout:Oe,handleClear:Ie,handleDeleteOption:Be,handlePatternInput:Me,handleKeydown:_e,handleTabOut:Ae,handleMenuMousedown:Ne,mergedTheme:N,cssVars:g?void 0:ee,themeClass:C==null?void 0:C.themeClass,onRender:C==null?void 0:C.onRender})},render(){const{mergedTheme:t,mergedClsPrefix:h,$slots:r}=this;return u("div",{class:`${h}-tree-select`},u(tt,null,{default:()=>[u(nt,null,{default:()=>u(bt,{ref:"triggerInstRef",onResize:this.handleTriggerOrMenuResize,status:this.mergedStatus,focused:this.focused,clsPrefix:h,theme:t.peers.InternalSelection,themeOverrides:t.peerOverrides.InternalSelection,ellipsisTagPopoverProps:this.ellipsisTagPopoverProps,renderTag:this.selectionRenderTag,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,size:this.mergedSize,bordered:this.bordered,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,active:this.mergedShow,loading:this.loading,multiple:this.multiple,maxTagCount:this.maxTagCount,showArrow:!0,filterable:this.filterable,clearable:this.clearable,pattern:this.pattern,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onClick:this.handleTriggerClick,onFocus:this.handleTriggerFocus,onBlur:this.handleTriggerBlur,onDeleteOption:this.handleDeleteOption,onKeydown:this.handleKeydown},{arrow:()=>{var s,d;return[(d=(s=this.$slots).arrow)===null||d===void 0?void 0:d.call(s)]}})}),u(at,{ref:"followerInstRef",show:this.mergedShow,placement:this.placement,to:this.adjustedTo,teleportDisabled:this.adjustedTo===j.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target"},{default:()=>u(lt,{name:"fade-in-scale-up-transition",appear:this.isMounted,onLeave:this.handleMenuLeave},{default:()=>{var s;if(!this.mergedShow)return null;const{mergedClsPrefix:d,checkable:y,multiple:K,menuProps:g,options:M}=this;return(s=this.onRender)===null||s===void 0||s.call(this),ot(u("div",Object.assign({},g,{class:[`${d}-tree-select-menu`,g==null?void 0:g.class,this.themeClass],ref:"menuElRef",style:[(g==null?void 0:g.style)||"",this.cssVars],tabindex:0,onMousedown:this.handleMenuMousedown,onKeydown:this.handleKeydown,onFocusin:this.handleMenuFocusin,onFocusout:this.handleMenuFocusout}),u(vt,{ref:"treeInstRef",blockLine:!0,allowCheckingNotLoaded:this.allowCheckingNotLoaded,showIrrelevantNodes:!1,animated:!1,pattern:this.pattern,getChildren:this.getChildren,filter:this.mergedFilter,data:M,cancelable:K,labelField:this.labelField,keyField:this.keyField,disabledField:this.disabledField,childrenField:this.childrenField,theme:t.peers.Tree,themeOverrides:t.peerOverrides.Tree,defaultExpandAll:this.defaultExpandAll,defaultExpandedKeys:this.defaultExpandedKeys,expandedKeys:this.mergedExpandedKeys,checkedKeys:this.treeCheckedKeys,selectedKeys:this.treeSelectedKeys,checkable:y,checkStrategy:this.checkStrategy,cascade:this.mergedCascade,leafOnly:this.leafOnly,multiple:this.multiple,renderLabel:this.renderLabel,renderPrefix:this.renderPrefix,renderSuffix:this.renderSuffix,renderSwitcherIcon:this.renderSwitcherIcon,nodeProps:this.nodeProps,watchProps:this.watchProps,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,overrideDefaultNodeClickBehavior:this.overrideDefaultNodeClickBehavior,internalTreeSelect:!0,internalUnifySelectCheck:!0,internalScrollable:!0,internalScrollablePadding:this.menuPadding,internalFocusable:!1,internalCheckboxFocusable:!1,internalRenderEmpty:()=>u("div",{class:`${d}-tree-select-menu__empty`},it(r.empty,()=>[u(St,{theme:t.peers.Empty,themeOverrides:t.peerOverrides.Empty})])),onLoad:this.onLoad,onUpdateCheckedKeys:this.handleUpdateCheckedKeys,onUpdateIndeterminateKeys:this.handleUpdateIndeterminateKeys,onUpdateExpandedKeys:this.doUpdateExpandedKeys}),dt(r.action,P=>P?u("div",{class:`${d}-tree-select-menu__action`,"data-action":!0},P):null),u(wt,{onFocus:this.handleTabOut})),[[rt,this.handleMenuClickoutside,void 0,{capture:!0}]])}})})]}))}});export{It as N};

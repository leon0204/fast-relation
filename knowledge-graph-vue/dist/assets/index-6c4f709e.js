var V=(T,R,r)=>new Promise((k,g)=>{var w=e=>{try{x(r.next(e))}catch(m){g(m)}},d=e=>{try{x(r.throw(e))}catch(m){g(m)}},x=e=>e.done?k(e.value):Promise.resolve(e.value).then(w,d);x((r=r.apply(T,R)).next())});import{U as pe,_ as me}from"./index.vue_vue_type_script_setup_true_lang-c8f76168.js";import{_ as fe}from"./CommonPage-69c64d74.js";import{d as ee,ap as de,m as c,aq as W,H as ae,Z as s,O as f,P as D,Q as n,R as t,S as i,U as A,W as S,ar as be,as as M,ak as Z,at as ce,$ as O,ai as Y,au as ye,a0 as F,F as P,X as J,av as ne,h as oe,aw as le,ax as ve,ay as ge,aj as se,az as he,_ as ke}from"./index-4af02034.js";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang-24ddc9a9.js";import"./ArrowUpOutlined-15a0d937.js";import"./UnorderedListOutlined-1cb56e24.js";import"./ChromeFilled-5bd66bf5.js";import"./EditFilled-d0e6b41f.js";import"./QuestionOutlined-b1288c8f.js";import"./AppPage-24725091.js";const we={style:{"text-align":"right"}},xe=ee({__name:"dataModel",props:{record:{},open:{type:Boolean}},emits:["OK","CANCEL"],setup(T,{emit:R}){const r=T,k=R,g=de(!1),w=c(),d=W({isOpenShot:!1});c(null),c(null),ae(()=>{var e;Object.assign(d,r.record),console.log((e=r.record)==null?void 0:e.data_source),console.log(d),d.data=JSON.stringify(d.data),d.data=JSON.stringify(JSON.parse(d.data),null,2)});function x(){return V(this,null,function*(){var m,p,$;const e=yield(m=w.value)==null?void 0:m.validateFields();g.value=!0,r.record.id&&be("/data_management/es/data/"+r.record.id+"?source_id="+(($=(p=r.record)==null?void 0:p.data_source)==null?void 0:$.source_id),JSON.parse(e.data)).then(l=>{g.value=!1,d.value=null,M("保存成功"),k("ok")})})}return(e,m)=>{const p=ue,$=s("a-textarea"),l=s("a-form-item"),u=s("a-col"),I=s("a-row"),_=s("a-form"),C=s("a-button"),N=s("a-space"),B=s("a-modal");return f(),D(B,{closable:!0,"destroy-on-close":!0,open:e.open,width:"900px",onOk:x},{title:n(()=>{var z;return[t(p,{title:(z=i(d))!=null&&z.id?"编辑":"新增","sub-title":""},null,8,["title"])]}),footer:n(()=>[A("div",we,[t(N,null,{default:n(()=>[t(C,{onClick:m[1]||(m[1]=()=>{k("cancel")})},{default:n(()=>[S(" 取消 ")]),_:1}),t(C,{type:"primary",loading:i(g),onClick:x},{default:n(()=>[S(" 保存 ")]),_:1},8,["loading"])]),_:1})])]),default:n(()=>[t(_,{ref_key:"formRef",ref:w,model:i(d),name:"basic","label-col":{span:6},"wrapper-col":{span:30},autocomplete:"off"},{default:n(()=>[t(I,null,{default:n(()=>[t(u,{span:24},{default:n(()=>[t(l,{name:"data"},{default:n(()=>[t($,{value:i(d).data,"onUpdate:value":m[0]||(m[0]=z=>i(d).data=z),rows:10,"auto-size":{minRows:10,maxRows:20}},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])}}}),Ce={style:{"text-align":"center"}},Oe=ee({__name:"connectionModel",props:{record:{},open:{type:Boolean}},emits:["OK","CANCEL"],setup(T,{emit:R}){const r=T;c([{label:"结构化数据",value:"结构化数据"},{label:"半结构数据",value:"半结构数据"},{label:"非结构化数据",value:"非结构化数据"}]);const k=c([]),g=c([]),w=R,d=de(!1),x=c(),e=W({isOpenShot:!1});function m(l){const u=l;console.log(l),Z("/datasource/id/"+u,{}).then(I=>{if(console.log(I.data),Object.assign(e,I.data),e.db_type=="Dameng"){const _={};_.name=e.name,_.data_type=e.data_type,_.db_type=e.db_type,_.ip_address=e.ip_address,_.username=e.username,_.password=e.password,_.schema_table=e.schema_table,_.table_name=e.table_name,_.port=e.port,_.source_id=e.source_id,d.value=!0,Y("/data_management/dm/schema",_).then(C=>{d.value=!1,console.log(C.fields),g.value=C.fields})}})}ae(()=>{Object.assign(e,r.record),p()});function p(){const l={};l.page=1,l.page_size=100,Z("/datasource/list",l).then(u=>{u.msg==""?u.data&&(k.value=u.data.data.map(I=>({label:I.name,value:I.id}))):showError(u.msg)})}function $(){return V(this,null,function*(){const l={};l.name=e.name,l.data_type=e.data_type,l.db_type=e.db_type,l.ip_address=e.ip_address,l.username=e.username,l.password=e.password,l.schema_table=e.schema_table,l.table_name=e.table_name,l.port=e.port,l.fields=e.db_type=="Dameng"?e.fields:[],l.source_id=e.source_id,d.value=!0,Y("/data_management/sync/es",l).then(u=>{d.value=!1,M(u.msg),w("ok")})})}return(l,u)=>{const I=ue,_=s("a-select"),C=s("a-form-item"),N=s("a-col"),B=s("a-input"),z=s("a-checkbox-group"),K=s("a-form"),G=s("a-button"),Q=s("a-space"),q=s("a-modal");return f(),D(q,{closable:!0,"destroy-on-close":!0,open:l.open,width:"600px",onOk:$},{title:n(()=>[t(I,{title:"同步","sub-title":""})]),footer:n(()=>[A("div",Ce,[t(Q,null,{default:n(()=>[t(G,{type:"primary",loading:i(d),onClick:$},{icon:n(()=>[t(i(ce))]),default:n(()=>[S(" 同步 ")]),_:1},8,["loading"])]),_:1})])]),default:n(()=>[t(K,{ref_key:"formRef",ref:x,model:i(e),name:"basic","label-col":{span:6},"wrapper-col":{span:30},autocomplete:"off"},{default:n(()=>[t(N,{span:20},{default:n(()=>[t(C,{label:"数据源",name:"id",rules:[{required:!0,message:"请选择数据源"}]},{default:n(()=>[t(_,{placeholder:"请选择数据源",value:i(e).id,"onUpdate:value":u[0]||(u[0]=U=>i(e).id=U),options:k.value,onChange:m},null,8,["value","options"])]),_:1})]),_:1}),t(N,{span:20},{default:n(()=>[t(C,{label:"库",name:"schema_table",disabled:""},{default:n(()=>[t(B,{disabled:"",value:i(e).schema_table,"onUpdate:value":u[1]||(u[1]=U=>i(e).schema_table=U),placeholder:"请输入库"},null,8,["value"])]),_:1})]),_:1}),t(N,{span:20},{default:n(()=>[t(C,{label:"表",name:"table_name"},{default:n(()=>[t(B,{disabled:"",value:i(e).table_name,"onUpdate:value":u[2]||(u[2]=U=>i(e).table_name=U),placeholder:"请输入表"},null,8,["value"])]),_:1})]),_:1}),i(e).db_type=="Dameng"?(f(),D(N,{key:0,span:20},{default:n(()=>[t(C,{label:"同步字段",name:"schema_table",disabled:""},{default:n(()=>[t(z,{value:i(e).fields,"onUpdate:value":u[3]||(u[3]=U=>i(e).fields=U),options:g.value},null,8,["value","options"])]),_:1})]),_:1})):O("",!0)]),_:1},8,["model"])]),_:1},8,["open"])}}}),Se={class:"content-table"},Ie=ee({__name:"index",setup(T){c();const R=W({}),r=c(!1);c([]);const k=c({});c([{label:"结构化数据",value:"结构化数据"},{label:"半结构数据",value:"半结构数据"},{label:"非结构化数据",value:"非结构化数据"}]),c([{label:"可用",value:1},{label:"不可用",value:2}]);const g=c([]);c(0);const w=c(!1),d=c(!1),x=c([]),e=c([]),m=c({authorization:"authorization-text"}),p=W({current:1,page_size:10,pageSizeOptions:["10","20","30","40"],page:1,total:0,showSizeChanger:!0,showQuickJumper:!1,showTotal:a=>`总记录 ${a} `,onChange(a,o){p.page_size=o,p.page=a,p.current=a,l()}}),$=c([{title:"数据名称",dataIndex:"name",key:"name",scopedSlots:{customRender:"name"},width:80},{title:"数据类型",dataIndex:"data_type",key:"data_type",scopedSlots:{customRender:"data_type"},width:70},{title:"数据库类型",dataIndex:"db_type",key:"db_type",scopedSlots:{customRender:"db_type"},width:70},{title:"库",dataIndex:"schema_table",key:"schema_table",scopedSlots:{customRender:"schema_table"},width:40},{title:"表",dataIndex:"table_name",key:"table_name",scopedSlots:{customRender:"table_name"},width:80},{title:"数据",dataIndex:"data",key:"data",scopedSlots:{customRender:"data"},width:200},{title:"同步时间",dataIndex:"synced_at",key:"synced_at",scopedSlots:{customRender:"synced_at"},width:80},{title:"操作",dataIndex:"action",width:110}]);function l(){if(r.value)return;r.value=!0;const a={};a.page=p.page,a.page_size=p.page_size,a.search=k.value.search?k.value.search:null,Z("/data_management/es/data",a).then(o=>{g.value=o.data,p.total=o.total,r.value=!1})}function u(){w.value=!1,l()}ae(()=>{l()});function I(){p.page=1,p.current=1,l()}function _(){d.value=!0}function C(){d.value=!1,l()}const N=a=>{ne.confirm({title:"提示",icon:oe(le),content:"要删除吗?",okText:"确定",cancelText:"取消",onOk(){var o;ve("/data_management/es/data/"+(a==null?void 0:a.id)+"?source_id="+((o=a==null?void 0:a.data_source)==null?void 0:o.source_id)).then(b=>{M("删除成功"),l()})},onCancel(){console.log("Cancel")}})},B=a=>{var o;ge("/data_management/download/binary/"+(a==null?void 0:a.data.download_by_id)+"?source_id="+((o=a==null?void 0:a.data_source)==null?void 0:o.source_id)).then(b=>{if(b){const y=a==null?void 0:a.data.file_type,L=new Blob([b],{type:y}),E=URL.createObjectURL(L),j=document.createElement("a");j.href=E;const H=y.split("/")[1];j.download=(a==null?void 0:a.data.download_by_id)+"."+H,document.body.appendChild(j),j.click(),document.body.removeChild(j),URL.revokeObjectURL(E)}})},z={onChange:(a,o)=>{console.log(`selectedRowKeys: ${a}`,"selectedRows: ",o),x.value=a},getCheckboxProps:a=>({disabled:a.name==="Disabled User",name:a.name})},K=a=>{const o={};return a.forEach(b=>{const y=b.data_source.source_id,L=b.id;o[y]?o[y].push(L):o[y]=[L]}),o},G=()=>{if(x.value.length==0)return se("请选择"),!1;const a=[];g.value.map(o=>{x.value.map(b=>{o.id==b&&a.push(o)})}),console.log(a),ne.confirm({title:"提示",icon:oe(le),content:"要批量删除吗?",okText:"确定",cancelText:"取消",onOk(){he("/data_management/es/data/bulk",K(a)).then(o=>{M("删除成功"),l()})},onCancel(){console.log("Cancel")}})},Q=a=>{if(!(a.type==="application/json"||a.name.endsWith(".json")))return se("请上传JSON格式的文件"),!1},q=c({}),U=a=>V(this,null,function*(){const o=a.file.uid||`${a.file.name}-${a.file.lastModified}`;if(a.file.status==="uploading"&&!q[o]){q[o]=!0;const b=new FormData;b.append("file",a.file.originFileObj,a.file.name),b.append("limit",10),Y("/data_management/upload/neo4j",b).then(y=>{y.code==null||y.code==""?(delete q[o],M(y.message),e.value=[]):M(y.msg)})}});return(a,o)=>{const b=s("a-input-search"),y=s("a-space"),L=s("a-col"),E=s("a-button"),j=s("a-upload"),H=s("a-row"),ie=s("a-tooltip"),X=me,te=s("a-divider"),re=s("a-table");return f(),D(fe,{"show-footer":"",title:"数据源管理"},{default:n(()=>[t(H,null,{default:n(()=>[t(L,{span:"16"},{default:n(()=>[t(y,null,{default:n(()=>[t(b,{value:k.value.search,"onUpdate:value":o[0]||(o[0]=h=>k.value.search=h),placeholder:"请输入关键字","enter-button":"查询",style:{width:"500px"},onSearch:I,loading:r.value},null,8,["value","loading"])]),_:1})]),_:1}),t(L,{span:8,style:{"text-align":"right"}},{default:n(()=>[t(y,null,{default:n(()=>[t(E,{type:"primary",style:{"background-color":"#F56C6C"},onClick:G},{default:n(()=>[t(i(ye)),S(" 批量删除 ")]),_:1}),t(E,{type:"primary",onClick:_},{icon:n(()=>[t(i(ce))]),default:n(()=>[S(" 数据同步 ")]),_:1}),t(j,{"file-list":e.value,"onUpdate:fileList":o[1]||(o[1]=h=>e.value=h),name:"file",headers:m.value,action:"false","before-upload":Q,"on-change":U,"max-count":1,showUploadList:!1,"auto-upload":!1},{default:n(()=>[t(E,{type:"primary"},{default:n(()=>[t(i(pe)),S(" 数据导入 ")]),_:1})]),_:1},8,["file-list","headers"])]),_:1})]),_:1})]),_:1}),A("div",Se,[t(re,{dataSource:g.value,columns:$.value,size:"middle",pagination:p,rowKey:"id","row-selection":z,loading:r.value},{bodyCell:n(({column:h,record:v})=>[h.dataIndex==="name"?(f(),F(P,{key:0},[S(J(v.data_source.name),1)],64)):O("",!0),h.dataIndex==="data_type"?(f(),F(P,{key:1},[S(J(v.data_source.data_type),1)],64)):O("",!0),h.dataIndex==="db_type"?(f(),F(P,{key:2},[S(J(v.data_source.db_type),1)],64)):O("",!0),h.dataIndex==="table_name"?(f(),F(P,{key:3},[S(J(v.data_source.table_name),1)],64)):O("",!0),h.dataIndex==="schema_table"?(f(),F(P,{key:4},[S(J(v.data_source.schema_table),1)],64)):O("",!0),h.dataIndex==="data"?(f(),D(ie,{key:5,placement:"leftTop"},{title:n(()=>[A("span",null,J(v.data),1)]),default:n(()=>[S(" "+J(JSON.stringify(v.data).length>60?JSON.stringify(v.data).substring(0,60)+"...":JSON.stringify(v.data)),1)]),_:2},1024)):O("",!0),h.dataIndex==="action"?(f(),F(P,{key:6},[v.data.data_type=="binary"?(f(),D(X,{key:0,icon:"ArrowDownOutlined",label:"下载",onClick:_e=>B(v)},null,8,["onClick"])):O("",!0),v.data.data_type=="binary"?(f(),D(te,{key:1,type:"vertical"})):O("",!0),t(X,{icon:"EditOutlined",label:"编辑",onClick:()=>{Object.assign(R,v),w.value=!0}},null,8,["onClick"]),t(te,{type:"vertical"}),t(X,{icon:"DeleteOutlined",label:"删除",onClick:_e=>N(v)},null,8,["onClick"])],64)):O("",!0)]),_:1},8,["dataSource","columns","pagination","loading"])]),w.value?(f(),D(xe,{key:0,record:R,open:w.value,onOk:u,onCancel:o[2]||(o[2]=h=>w.value=!1)},null,8,["record","open"])):O("",!0),d.value?(f(),D(Oe,{key:1,record:R,open:d.value,onOk:C,onCancel:o[3]||(o[3]=h=>d.value=!1)},null,8,["record","open"])):O("",!0)]),_:1})}}});const Ee=ke(Ie,[["__scopeId","data-v-d3c62662"]]);export{Ee as default};
